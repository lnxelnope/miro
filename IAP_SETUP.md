# In-App Purchase Setup Guide

## ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: Setup ‡πÉ‡∏ô Google Play Console

‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà In-App Purchase ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á setup ‡πÉ‡∏ô Play Console ‡∏Å‡πà‡∏≠‡∏ô

---

## üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Setup

### 1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Play Console ‚Üí Monetize

```
Google Play Console
‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏≠‡∏õ MIRO
‚Üí Monetize ‚Üí In-app products
‚Üí Create product
```

### 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Product

#### Product Details:
- **Product ID**: `miro-pro` (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô code)
- **Name**: `MIRO Pro`
- **Description**: `Unlock unlimited AI food analysis. No daily limits!`

#### Product Type:
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **One-time purchase** (‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÉ‡∏ä‡πâ‡∏ï‡∏•‡∏≠‡∏î)

#### Pricing:
‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô:
- ‡πÑ‡∏ó‡∏¢: ‡∏ø99
- ‡∏™‡∏´‡∏£‡∏±‡∏ê: $2.99
- ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ template pricing ‡∏à‡∏≤‡∏Å Google

#### Status:
- ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô **Active** ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. Test Accounts (License Testing)

‡πÑ‡∏õ‡∏ó‡∏µ‡πà Play Console ‚Üí Setup ‚Üí License testing:

1. ‡πÄ‡∏û‡∏¥‡πà‡∏° Gmail ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
2. License response: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `RESPOND_NORMALLY`
3. Save

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏Å‡πà‡∏≠‡∏ô publish

### 2. ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

1. Build ‡πÅ‡∏•‡∏∞ upload version ‡πÉ‡∏´‡∏°‡πà (1.0.2+6) ‡πÑ‡∏õ Internal Testing
2. ‡∏£‡∏≠ Google ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (5-30 ‡∏ô‡∏≤‡∏ó‡∏µ)
3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å Play Store ‡∏ö‡∏ô device ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô test account
4. ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ ‚Üí Profile ‚Üí ‡∏Å‡∏î "Upgrade to Pro"
5. ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô dialog ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
6. ‡∏Å‡∏î Subscribe/Buy
7. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô test account ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ Pro

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Logs

‡πÄ‡∏õ‡∏¥‡∏î Android Studio ‚Üí Logcat ‚Üí filter: `PurchaseService`

‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô log ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:
```
[PurchaseService] üõí IAP available: true
[PurchaseService] ‚úÖ Purchase stream listening
[PurchaseService] ‚úÖ Restore completed
[PurchaseService] üõí Querying product: miro-pro
[PurchaseService] ‚úÖ Product found: MIRO Pro - ‡∏ø99.00
[PurchaseService] üõí Initiating purchase...
[PurchaseService] üì¶ Received 1 purchase updates
[PurchaseService] ‚úÖ Pro unlocked!
```

---

## ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢

### 1. ‚ùå "Product not found"

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á product ‡πÉ‡∏ô Play Console
- Product ID ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö `miro-pro`
- Product status ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô "Active"
- ‡πÅ‡∏≠‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ publish ‡πÑ‡∏õ‡∏¢‡∏±‡∏á internal test track

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Play Console ‚Üí Monetize ‚Üí In-app products
2. ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ product ID: `miro-pro`
3. ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô **Active**
4. ‡πÅ‡∏≠‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ version ‡∏ó‡∏µ‡πà publish ‡πÅ‡∏•‡πâ‡∏ß (by‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ Internal test)

### 2. ‚ùå "IAP not available"

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Google Play Services
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å APK ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ú‡πà‡∏≤‡∏ô Play Store)

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å Play Store ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡πÉ‡∏ä‡πâ Internal Test track ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 3. ‚ùå ‡∏Å‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡∏Ç‡∏≤‡∏î BILLING permission (‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô version 1.0.2)
- Purchase stream ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- Error ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡∏î‡∏π Logcat ‡∏à‡∏∞‡∏ö‡∏≠‡∏Å error
- Update ‡πÄ‡∏õ‡πá‡∏ô version 1.0.2+6 (‡∏°‡∏µ debug logging)

---

## üîê Security Best Practices

### ‚úÖ ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß:
- ‡πÉ‡∏ä‡πâ `buyNonConsumable` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö one-time purchase
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `completePurchase()` ‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à
- Restore purchases ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
- ‡πÄ‡∏Å‡πá‡∏ö Pro status ‡πÉ‡∏ô SharedPreferences (offline-first)

### ‚ö†Ô∏è ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Production:
- Server-side verification (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö purchase ‡∏ó‡∏µ‡πà server)
- Receipt validation ‡∏Å‡∏±‡∏ö Google Play API
- Prevent piracy ‡πÅ‡∏•‡∏∞ unauthorized unlocks

**Note:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö v1.0 ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ client-side verification ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏≠‡∏õ‡πÄ‡∏•‡πá‡∏Å‡πÜ)

---

## üì± ‡∏Å‡∏≤‡∏£ Restore Purchase

‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡πÅ‡∏≠‡∏õ:

1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÉ‡∏´‡∏°‡πà
2. ‡πÑ‡∏õ Profile ‚Üí "Restore Purchase"
3. Google ‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
4. ‡∏ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ Pro ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

---

## üöÄ Build ‡πÅ‡∏•‡∏∞ Upload

```bash
# 1. Clean
flutter clean
flutter pub get

# 2. Build
flutter build appbundle --release

# 3. Upload
# build/app/outputs/bundle/release/app-release.aab
```

Upload ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Internal Testing track ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà

---

## ‚úÖ Checklist

- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° BILLING permission ‡πÉ‡∏ô AndroidManifest
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° debug logging ‡πÉ‡∏ô PurchaseService
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° loading dialog ‡πÅ‡∏•‡∏∞ error messages
- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á product ‡πÉ‡∏ô Play Console (`miro-pro`)
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Active
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° test account ‡πÉ‡∏ô License testing
- [ ] Build version 1.0.2+6
- [ ] Upload ‡πÑ‡∏õ Internal Testing
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Logcat
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞ restore

---

## üìû Support

‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á Logcat output ‡∏°‡∏≤ ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢ debug ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö

```bash
adb logcat | grep -E "PurchaseService|IAP"
```
